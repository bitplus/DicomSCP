"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7013,4759,3326,4182],{75183:(e,t,a)=>{var n;a.d(t,{A:()=>i}),function(e){e.Interaction="Interaction",e.HandlesUpdated="HandlesUpdated",e.StatsUpdated="StatsUpdated",e.InitialSetup="InitialSetup",e.Completed="Completed",e.InterpolationUpdated="InterpolationUpdated"}(n||(n={}));const i=n},94021:(e,t,a)=>{var n;a.d(t,{A:()=>i}),function(e){e.TOOL_ACTIVATED="CORNERSTONE_TOOLS_TOOL_ACTIVATED",e.TOOLGROUP_VIEWPORT_ADDED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_ADDED",e.TOOLGROUP_VIEWPORT_REMOVED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_REMOVED",e.TOOL_MODE_CHANGED="CORNERSTONE_TOOLS_TOOL_MODE_CHANGED",e.ANNOTATION_ADDED="CORNERSTONE_TOOLS_ANNOTATION_ADDED",e.ANNOTATION_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_COMPLETED",e.ANNOTATION_MODIFIED="CORNERSTONE_TOOLS_ANNOTATION_MODIFIED",e.ANNOTATION_REMOVED="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",e.ANNOTATION_SELECTION_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_SELECTION_CHANGE",e.ANNOTATION_LOCK_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_LOCK_CHANGE",e.ANNOTATION_VISIBILITY_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_VISIBILITY_CHANGE",e.ANNOTATION_RENDERED="CORNERSTONE_TOOLS_ANNOTATION_RENDERED",e.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_INTERPOLATION_PROCESS_COMPLETED",e.INTERPOLATED_ANNOTATIONS_REMOVED="CORNERSTONE_TOOLS_INTERPOLATED_ANNOTATIONS_REMOVED",e.SEGMENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_MODIFIED",e.SEGMENTATION_RENDERED="CORNERSTONE_TOOLS_SEGMENTATION_RENDERED",e.SEGMENTATION_REPRESENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_ADDED",e.SEGMENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_ADDED",e.SEGMENTATION_REPRESENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_MODIFIED",e.SEGMENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REMOVED",e.SEGMENTATION_REPRESENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_REMOVED",e.SEGMENTATION_DATA_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_DATA_MODIFIED",e.KEY_DOWN="CORNERSTONE_TOOLS_KEY_DOWN",e.KEY_UP="CORNERSTONE_TOOLS_KEY_UP",e.MOUSE_DOWN="CORNERSTONE_TOOLS_MOUSE_DOWN",e.MOUSE_UP="CORNERSTONE_TOOLS_MOUSE_UP",e.MOUSE_DOWN_ACTIVATE="CORNERSTONE_TOOLS_MOUSE_DOWN_ACTIVATE",e.MOUSE_DRAG="CORNERSTONE_TOOLS_MOUSE_DRAG",e.MOUSE_MOVE="CORNERSTONE_TOOLS_MOUSE_MOVE",e.MOUSE_CLICK="CORNERSTONE_TOOLS_MOUSE_CLICK",e.MOUSE_DOUBLE_CLICK="CORNERSTONE_TOOLS_MOUSE_DOUBLE_CLICK",e.MOUSE_WHEEL="CORNERSTONE_TOOLS_MOUSE_WHEEL",e.TOUCH_START="CORNERSTONE_TOOLS_TOUCH_START",e.TOUCH_START_ACTIVATE="CORNERSTONE_TOOLS_TOUCH_START_ACTIVATE",e.TOUCH_PRESS="CORNERSTONE_TOOLS_TOUCH_PRESS",e.TOUCH_DRAG="CORNERSTONE_TOOLS_TOUCH_DRAG",e.TOUCH_END="CORNERSTONE_TOOLS_TOUCH_END",e.TOUCH_TAP="CORNERSTONE_TOOLS_TAP",e.TOUCH_SWIPE="CORNERSTONE_TOOLS_SWIPE"}(n||(n={}));const i=n},18682:(e,t,a)=>{var n;a.d(t,{A:()=>i}),function(e){e.Labelmap="Labelmap",e.Contour="Contour",e.Surface="Surface"}(n||(n={}));const i=n},84093:(e,t,a)=>{var n;a.d(t,{A:()=>i}),function(e){e.OnInteractionStart="onInteractionStart",e.OnInteractionEnd="onInteractionEnd",e.Preview="preview",e.RejectPreview="rejectPreview",e.AcceptPreview="acceptPreview",e.Fill="fill",e.StrategyFunction="strategyFunction",e.CreateIsInThreshold="createIsInThreshold",e.Initialize="initialize",e.INTERNAL_setValue="setValue",e.ComputeInnerCircleRadius="computeInnerCircleRadius"}(n||(n={}));const i=n},66452:(e,t,a)=>{var n,i;a.d(t,{i:()=>n,q:()=>i}),function(e){e[e.Primary=1]="Primary",e[e.Secondary=2]="Secondary",e[e.Primary_And_Secondary=3]="Primary_And_Secondary",e[e.Auxiliary=4]="Auxiliary",e[e.Primary_And_Auxiliary=5]="Primary_And_Auxiliary",e[e.Secondary_And_Auxiliary=6]="Secondary_And_Auxiliary",e[e.Primary_And_Secondary_And_Auxiliary=7]="Primary_And_Secondary_And_Auxiliary",e[e.Fourth_Button=8]="Fourth_Button",e[e.Fifth_Button=16]="Fifth_Button",e[e.Wheel=524288]="Wheel",e[e.Wheel_Primary=524289]="Wheel_Primary"}(n||(n={})),function(e){e[e.Shift=16]="Shift",e[e.Ctrl=17]="Ctrl",e[e.Alt=18]="Alt",e[e.Meta=91]="Meta",e[e.ShiftCtrl=1617]="ShiftCtrl",e[e.ShiftAlt=1618]="ShiftAlt",e[e.ShiftMeta=1691]="ShiftMeta",e[e.CtrlAlt=1718]="CtrlAlt",e[e.CtrlMeta=1791]="CtrlMeta",e[e.AltMeta=1891]="AltMeta"}(i||(i={}))},49892:(e,t,a)=>{var n;a.d(t,{A:()=>i}),function(e){e.Active="Active",e.Passive="Passive",e.Enabled="Enabled",e.Disabled="Disabled"}(n||(n={}));const i=n},10401:(e,t,a)=>{var n;a.d(t,{H:()=>n}),function(e){e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT"}(n||(n={}))},99737:(e,t,a)=>{a.r(t),a.d(t,{AnnotationStyleStates:()=>s,ChangeTypes:()=>u.A,Events:()=>l.A,KeyboardBindings:()=>i.q,MouseBindings:()=>i.i,SegmentationRepresentations:()=>c.A,StrategyCallbacks:()=>m.A,Swipe:()=>p.H,ToolModes:()=>o.A,WorkerTypes:()=>d});var n,i=a(66452),o=a(49892);!function(e){e.Default="",e.Highlighted="Highlighted",e.Selected="Selected",e.Locked="Locked",e.AutoGenerated="AutoGenerated"}(n||(n={}));const s=n;var r,l=a(94021),c=a(18682),p=a(10401),m=a(84093),u=a(75183);!function(e){e.POLYSEG_CONTOUR_TO_LABELMAP="Converting Contour to Labelmap",e.POLYSEG_SURFACE_TO_LABELMAP="Converting Surfaces to Labelmap",e.POLYSEG_CONTOUR_TO_SURFACE="Converting Contour to Surface",e.POLYSEG_LABELMAP_TO_SURFACE="Converting Labelmap to Surface",e.SURFACE_CLIPPING="Clipping Surfaces"}(r||(r={}));const d=r},14696:(e,t,a)=>{a.r(t),a.d(t,{default:()=>G});var n={};a.r(n),a.d(n,{updateSegmentationsChartDisplaySet:()=>O});const i=JSON.parse('{"UU":"@ohif/extension-cornerstone-dynamic-volume"}').UU;var o=a(80818),s=a(81985),r=a(55139);const l="CHT",c=o.Wp.guid(),p="1.9.451.13215.7.3.2.7.6.1",{utilities:m}=r;function u(e,t){const a=e.imageIds.reduce(((e,a)=>{const n=o.H8.getInstanceByImageId(a)[t];return void 0!==n&&e.add(n),e}),new Set);return Array.from(a).sort(((e,t)=>e-t))}function d(e,t,{servicesManager:a}){const{displaySetService:n,segmentationService:i,viewportGridService:r}=a.services;let l;const c=n.getActiveDisplaySets().find((e=>{const t=e.instances?.[0];return!!t&&(void 0!==t.FrameReferenceTime||void 0!==t.NumberOfTimeSlices)})).displaySetInstanceUID;for(const[e]of s.cache._volumeCache)if(e.includes(c)){l=e;break}let p;l&&(p=s.cache.getVolume(l));const{StudyInstanceUID:d,StudyDescription:S}=o.H8.getInstanceByImageId(p.imageIds[0]),O=i.getLabelmapVolume(e.segmentationId),E=O?.volumeId,[y,T]=m.dynamicVolume.getDataInTime(p,{maskVolumeId:E}),g=y.length;if(0===g)return[];const I=r.getActiveViewportId(),D=i.getSegmentColor(I,e.segmentationId,1),N=s.utilities.color.rgbToHex(D[0],D[1],D[2]);let v=t.get(p);v||(v=function(e){const t={FrameReferenceTime:{unit:"ms"}},a=Object.keys(t);let n,i;for(let o=0;o<a.length;o++){const s=a[o],r=u(e,s);if(r.length){n=r,i=t[s].unit;break}}if(!n.length){const e=a.join(", ");throw new Error(`Could not extract time points data for the following tags: ${e}`)}const o=function(e,t){const a=["ms","s","m","h"],n=[1e3,60,60],i=a.indexOf(t);let o=1;if(-1!==i){for(let s=i;s<a.length-1;s++){const i=o*n[s];if(e.filter((e=>e>i)).length<=e.length/2)break;o=i,t=a[s+1]}o>1&&(e=e.map((e=>e/o)))}return{timePoints:e,timePointsUnit:t}}(n,i);return n=o.timePoints,i=o.timePointsUnit,{timePoints:n,timePointsUnit:i}}(p),t.set(p,v));const{timePoints:_,timePointsUnit:C}=v;if(_.length!==y[0].length)throw new Error("Invalid number of time points returned");const h=_.length,f=new Array(h);for(let e=0;e<h;e++){const t=y.reduce(((t,a)=>t+a[e]/g),0);f[e]=[_[e],t]}return{StudyInstanceUID:d,StudyDescription:S,chartData:{series:{label:e.label,points:f,color:N},axis:{x:{label:`Time (${C})`},y:{label:"Vl (Bq/ml)"}}}}}function S(e,{servicesManager:t}){if(!e.length)return;const a=new WeakMap,n=e.map((e=>d(e,a,{servicesManager:t}))),{date:i,time:s}=function(){const e=new Date;return{date:e.getFullYear()+("0"+e.getUTCMonth()).slice(-2)+("0"+e.getUTCDate()).slice(-2),time:("0"+e.getUTCHours()).slice(-2)+("0"+e.getUTCMinutes()).slice(-2)+("0"+e.getUTCSeconds()).slice(-2)}}(),r=n.reduce(((e,t)=>[...e,t.chartData.series]),[]),m={SOPClassUID:p,Modality:l,SOPInstanceUID:o.Wp.guid(),SeriesDate:i,SeriesTime:s,SeriesInstanceUID:c,StudyInstanceUID:n[0].StudyInstanceUID,StudyDescription:n[0].StudyDescription,SeriesNumber:100,SeriesDescription:"Segmentation chart series data",chartData:{series:r,axis:{...n[0].chartData.axis}}};return{seriesMetadata:{StudyInstanceUID:m.StudyInstanceUID,StudyDescription:m.StudyDescription,SeriesInstanceUID:m.SeriesInstanceUID,SeriesDescription:m.SeriesDescription,SeriesNumber:m.SeriesNumber,SeriesTime:m.SeriesTime,SOPClassUID:m.SOPClassUID,Modality:m.Modality},instance:m}}function O({servicesManager:e}){const{segmentationService:t}=e.services,a=t.getSegmentations(),{seriesMetadata:n,instance:i}=S(a,{servicesManager:e})??{};n&&i&&(o.H8.addSeriesMetadata([n],!0),o.H8.addInstances([i],!0))}r.Enums.SegmentationRepresentations.Labelmap;const E=({commandsManager:e,servicesManager:t})=>{const a=t.services,{displaySetService:i,viewportGridService:o,segmentationService:l}=a,c={...n,getDynamic4DDisplaySet:()=>i.getActiveDisplaySets().find((e=>{const t=e.instances?.[0];return!!t&&(void 0!==t.FrameReferenceTime||void 0!==t.NumberOfTimeSlices||void 0!==t.TemporalPositionIdentifier)})),getComputedDisplaySets:()=>[...i.getDisplaySetCache().values()].filter((e=>e.isDerived)),exportTimeReportCSV:({segmentations:e,config:t,options:a,summaryStats:n})=>{const i=c.getDynamic4DDisplaySet(),o=i?.displaySetInstanceUID;let p,m;for(const[e]of s.cache._volumeCache)if(e.includes(o)){p=e;break}p&&(m=s.cache.getVolume(p));const u=i.instances[0],d=[];function S(e){const t=e.length,a=e.reduce(((e,t)=>e+t),0)/t,n=e.map((e=>(e-a)**2)).reduce(((e,t)=>e+t),0)/t;return Math.sqrt(n)}d.push(`Patient ID,${u.PatientID},`),d.push(`Study Date,${u.StudyDate},`),d.push(`StudyInstanceUID,${u.StudyInstanceUID},`),d.push(`StudyDescription,${u.StudyDescription},`),d.push(`SeriesInstanceUID,${u.SeriesInstanceUID},`),d.push(""),d.push(""),e.forEach((e=>{const t=l.getLabelmapVolume(e.segmentationId),[a,i]=r.utilities.dynamicVolume.getDataInTime(m,{maskVolumeId:t.volumeId});if(n){let t="Operation,Segmentation Label ID";const n=m.numTimePoints;for(let e=0;e<n;e++)t+=`,Time Point ${e}`;d.push(t);const o=[],s=[],r=[],l=[],c=[],p=[],u=a.length;for(let e=0;e<n;e++){const t=[];let n=0,m=1/0,d=-1/0,O=0,E=0;for(let i=0;i<u;i++){const o=a[i][e];t.push(o),n+=o,o<m&&(m=o,O=i),o>d&&(d=o,E=i)}o.push(n/u),s.push(m),r.push(i[O]),l.push(d),c.push(i[E]),p.push(S(t))}let O=`Mean,${e.label}`;for(let e=0;e<n;e++)O+=`,${o[e]}`;d.push(O),O=`Standard Deviation,${e.label}`;for(let e=0;e<n;e++)O+=`,${p[e]}`;d.push(O),O=`Min,${e.label}`;for(let e=0;e<n;e++)O+=`,${s[e]}`;d.push(O),O=`Max,${e.label}`;for(let e=0;e<n;e++)O+=`,${l[e]}`;d.push(O)}else{let t="Pixel Identifier (IJK),Segmentation Label ID";const n=m.numTimePoints;for(let e=0;e<n;e++)t+=`,Time Point ${e}`;d.push(t);for(let t=0;t<a.length;t++){let n=`${`${i[t][0]}_${i[t][1]}_${i[t][2]}`},${e.label}`;for(let e=0;e<a[t].length;e++)n+=`,${a[t][e]}`;d.push(n)}}}));const O=d.join("\n"),E=`${u.PatientID}.csv`,y=new Blob([O],{type:"text/csv;charset=utf-8;"}),T=document.createElement("a"),g=URL.createObjectURL(y);T.setAttribute("href",g),T.setAttribute("download",E),T.style.visibility="hidden",document.body.appendChild(T),T.click(),document.body.removeChild(T)},swapDynamicWithComputedDisplaySet:({displaySet:e})=>{const t=e,a=i.getDisplaySetCache(),n=[a.keys()],{displaySetInstanceUID:s}=t;n.includes(s)||a.set(s,t);const{viewports:r}=o.getState(),l=c.getDynamic4DDisplaySet(),p=[];for(const[e,t]of r){const e=t,a=e.viewportOptions,{displaySetInstanceUIDs:n}=e,i=n.indexOf(l.displaySetInstanceUID);if(-1!==i){const t={viewportId:e.viewportId,displaySetInstanceUIDs:[...n.slice(0,i),s,...n.slice(i+1)],viewportOptions:{initialImageOptions:a.initialImageOptions,viewportType:"volume",orientation:a.orientation,background:a.background}};p.push(t)}}o.setDisplaySetsForViewports(p)},swapComputedWithDynamicDisplaySet:()=>{const e=c.getDynamic4DDisplaySet(),t=i.getDisplaySetCache(),a=[...t.keys()],{displaySetInstanceUID:n}=e;a.includes(n)||t.set(n,e);const{viewports:s}=o.getState(),r=c.getComputedDisplaySets()[0],l=[];for(const[e,t]of s){const e=t,a=e.viewportOptions,{displaySetInstanceUIDs:i}=e,o=i.indexOf(r.displaySetInstanceUID);if(-1!==o){const t={viewportId:e.viewportId,displaySetInstanceUIDs:[...i.slice(0,o),n,...i.slice(o+1)],viewportOptions:{initialImageOptions:a.initialImageOptions,viewportType:"volume",orientation:a.orientation,background:a.background}};l.push(t)}}o.setDisplaySetsForViewports(l)},createNewLabelMapForDynamicVolume:async({label:e})=>{const{viewports:t,activeViewportId:a}=o.getState(),n=c.getDynamic4DDisplaySet(),s=n.displaySetInstanceUID;let r;if(t.get(a).displaySetInstanceUIDs.includes(s)&&(r=n),!r){const e=i.getDisplaySetCache();for(const[t,a]of e)if(a.referenceDisplaySetUID===s){r=a;break}}if(!r)throw new Error("No reference display set found based on the dynamic data");const p=i.getDisplaySetByUID(r.displaySetInstanceUID),m=await l.createLabelmapForDisplaySet(p,{label:e}),u=t.values().next().value;return await l.addSegmentationRepresentation(u.viewportId,{segmentationId:m}),m}},p={updateSegmentationsChartDisplaySet:{commandFn:c.updateSegmentationsChartDisplaySet,storeContexts:[],options:{}},exportTimeReportCSV:{commandFn:c.exportTimeReportCSV,storeContexts:[],options:{}},swapDynamicWithComputedDisplaySet:{commandFn:c.swapDynamicWithComputedDisplaySet,storeContexts:[],options:{}},createNewLabelMapForDynamicVolume:{commandFn:c.createNewLabelMapForDynamicVolume,storeContexts:[],options:{}},swapComputedWithDynamicDisplaySet:{commandFn:c.swapComputedWithDynamicDisplaySet,storeContexts:[],options:{}}};return{actions:c,definitions:p,defaultContext:"DYNAMIC-VOLUME:CORNERSTONE"}};var y=a(86326),T=a(35647),g=a(35570);function I(){return I=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},I.apply(null,arguments)}const D={sizeClassName:"w-[58px] h-[28px]",arrowsDirection:"horizontal",labelPosition:"bottom"},N=({title:e,tooltip:t})=>y.createElement("div",{className:"flex items-center space-x-1"},y.createElement(T.m_,{content:y.createElement("div",{className:"text-white"},t),position:"bottom-left",tight:!0,tooltipBoxClassName:"max-w-xs p-2"},y.createElement(T.In,{name:"info-link",className:"text-primary-active h-[14px] w-[14px]"})),y.createElement("span",{className:"text-aqua-pale text-[11px] uppercase"},e)),v=({isPlaying:e,onPlayPauseChange:t,fps:a,onFpsChange:n,minFps:i,maxFps:o,currentFrameIndex:r,onFrameChange:l,framesLength:c,onGenerate:p,onDoubleRangeChange:m,onDynamicClick:u})=>{const[d,S]=(0,y.useState)(!1),[O,E]=(0,y.useState)(s.Enums.DynamicOperatorType.SUM),[I,D]=(0,y.useState)([0,c-1]);return y.createElement("div",{className:"flex select-none flex-col"},y.createElement(T.aU,{title:"Controls",childrenClassName:"space-y-4 pb-5 px-5"},y.createElement("div",{className:"mt-2"},y.createElement(N,{title:"View",tooltip:"Select the view mode, 4D to view the dynamic volume or Computed to view the computed volume"}),y.createElement(T.e2,{className:"mt-2 w-full"},y.createElement("button",{className:"w-1/2",onClick:()=>{S(!1),u?.()}},"4D"),y.createElement("button",{className:"w-1/2",onClick:()=>{S(!0)}},"Computed"))),y.createElement("div",null,y.createElement(_,{onPlayPauseChange:t,isPlaying:e,computedView:d,fps:a,onFpsChange:n,minFps:i,maxFps:o,framesLength:c,onFrameChange:l,currentFrameIndex:r})),y.createElement("div",{className:"mt-6 flex flex-col "+(d?"":"ohif-disabled")},y.createElement(N,{title:"Computed Operation",tooltip:y.createElement("div",null,"Operation Buttons (SUM, AVERAGE, SUBTRACT): Select the mathematical operation to be applied to the data set.",y.createElement("br",null)," Range Slider: Choose the numeric range within which the operation will be performed.",y.createElement("br",null),"Generate Button: Execute the chosen operation on the specified range of data."," ")}),y.createElement(T.e2,{className:"mt-2 w-full",separated:!0},y.createElement("button",{className:"w-1/2",onClick:()=>E(s.Enums.DynamicOperatorType.SUM)},s.Enums.DynamicOperatorType.SUM.toString().toUpperCase()),y.createElement("button",{className:"w-1/2",onClick:()=>E(s.Enums.DynamicOperatorType.AVERAGE)},s.Enums.DynamicOperatorType.AVERAGE.toString().toUpperCase()),y.createElement("button",{className:"w-1/2",onClick:()=>E(s.Enums.DynamicOperatorType.SUBTRACT)},s.Enums.DynamicOperatorType.SUBTRACT.toString().toUpperCase())),y.createElement("div",{className:"mt-2 w-full"},y.createElement(g.Jg,{min:0,max:c-1,step:1,defaultValue:I,onValueChange:e=>{m(e),D(e)},formatLabel:e=>Math.round(e),className:"w-full"})),y.createElement(T.$n,{className:"mt-2 !h-[26px] !w-[115px] self-start !p-0",onClick:()=>{p(O)}},"Generate"))))};function _({isPlaying:e,onPlayPauseChange:t,fps:a,minFps:n,maxFps:i,onFpsChange:o,framesLength:s,onFrameChange:r,currentFrameIndex:l,computedView:c}){return y.createElement("div",{className:c&&"ohif-disabled"},y.createElement(N,{title:"4D Controls",tooltip:y.createElement("div",null,"Play/Pause Button: Begin or pause the animation of the 4D visualization. ",y.createElement("br",null)," Frame Selector: Navigate through individual frames of the 4D data. ",y.createElement("br",null)," FPS (Frames Per Second) Selector: Adjust the playback speed of the animation.")}),y.createElement("div",{className:"mt-3 flex justify-between"},y.createElement(T.K0,{className:"bg-customblue-30 h-[26px] w-[58px] rounded-[4px]",onClick:()=>t(!e)},y.createElement(T.In,{name:e?"icon-pause":"icon-play",className:"active:text-primary-light hover:bg-customblue-300 h-[24px] w-[24px] cursor-pointer text-white"})),y.createElement(T.YI,I({value:l,onChange:r,minValue:0,maxValue:s-1,label:"Frame"},D)),y.createElement(T.YI,I({value:a,onChange:o,minValue:n,maxValue:i},D,{label:"FPS"}))))}const C="@ohif/extension-default.sopClassHandlerModule.stack";function h({servicesManager:e,commandsManager:t}){const{cornerstoneViewportService:a,viewportGridService:n,displaySetService:i}=e.services,[{isCineEnabled:o},l]=(0,T.tq)(),[{activeViewportId:c}]=(0,T.ih)(),[p,m]=(0,y.useState)([0,0]),[u,d]=(0,y.useState)([0,0]),[S,O]=(0,y.useState)(null),[E,g]=(0,y.useState)(null),[I,D]=(0,y.useState)(20),[N,_]=(0,y.useState)(o),[h,f]=(0,y.useState)(null),[R,A]=(0,y.useState)(!1),M=(0,y.useRef)(s.utilities.uuidv4()),w=(0,y.useRef)(null),L=`cornerstoneStreamingImageVolume:${M.current}`;function P(e){t.runCommand("swapDynamicWithComputedDisplaySet",{displaySet:e}),A(!0)}(0,y.useEffect)((()=>{const t=a.EVENTS.VIEWPORT_DATA_CHANGED,n=e.services.cineService.EVENTS.CINE_STATE_CHANGED,{unsubscribe:i}=a.subscribe(t,(e=>{e.viewportData.data.forEach((e=>{if(e.volume?.isDynamicVolume()){g(e.volume),w.current=e.displaySetInstanceUID;const t=[1,e.volume.numTimePoints];m(t),d(t)}}))})),{unsubscribe:o}=e.services.cineService.subscribe(n,(e=>{_(e.isPlaying)}));return()=>{i(),o()}}),[a,l,e.services.cineService]),(0,y.useEffect)((()=>{const e=s.Enums.Events.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED,t=e=>{f(e.detail.timePointIndex)};return s.eventTarget.addEventListener(e,t),()=>{s.eventTarget.removeEventListener(e,t)}}),[a]),(0,y.useEffect)((()=>{const e=n.getDisplaySetsUIDsForViewport(c);if(!e?.length)return;const t=e.map(i.getDisplaySetByUID).find((e=>e.isDynamicVolume));if(!t)return;const a=s.cache.getVolumes().find((e=>e.volumeId.includes(t.displaySetInstanceUID)));if(!a)return;g(a),w.current=t.displaySetInstanceUID;const o=[1,a.numTimePoints];m(o),d(o)}),[c,n,i,a,l]);const U=()=>{_(!0);const e=a.getViewportInfo(c);if(!e)return;const{element:t}=e;l.playClip(t,{framesPerSecond:I,viewportId:c})},b=()=>{_(!1);const{element:e}=a.getViewportInfo(c);l.stopClip(e)};return E&&0!==p.length?y.createElement(v,{fps:I,isPlaying:N,onPlayPauseChange:e=>{e?U():b()},minFps:1,maxFps:50,currentFrameIndex:h,onFpsChange:e=>{D(e),b(),U()},framesLength:p[1],onFrameChange:e=>{E.timePointIndex=e},onGenerate:async function(e){const n=E.volumeId;if(!n)return;let i=s.cache.getVolume(L);i||(i=await s.volumeLoader.createAndCacheDerivedVolume(n,{volumeId:L}));const[o,l]=u,c=Array.from({length:l-o+1},((e,t)=>t+o-1)),p={frameNumbers:"SUBTRACT"===e?[o,l-1]:c,targetVolume:i};if(r.utilities.dynamicVolume.updateVolumeFromTimeData(E,e,p),S)t.runCommand("updateVolumeData",{volume:i}),a.getRenderingEngine().render(),P(S);else{const e={volumeLoaderSchema:i.volumeId.split(":")[0],displaySetInstanceUID:M.current,SOPClassHandlerId:C,Modality:E.metadata.Modality,isMultiFrame:!1,numImageFrames:1,uid:M.current,referenceDisplaySetUID:E.volumeId.split(":")[1],madeInClient:!0,FrameOfReferenceUID:E.metadata.FrameOfReferenceUID,isDerived:!0,imageIds:i.imageIds};O(e),P(e)}},onDynamicClick:R?()=>{t.runCommand("swapComputedWithDynamicDisplaySet")}:null,onDoubleRangeChange:function(e){e[0]===u[0]&&e[1]===u[1]||d(e)},initialRangeValues:u}):null}const f=function({servicesManager:e,commandsManager:t,tab:a}){return y.createElement(y.Fragment,null,y.createElement("div",{className:"flex flex-col text-white","data-cy":"dynamic-volume-panel"},y.createElement(h,{commandsManager:t,servicesManager:e})))};var R=a(11185);const A=function({commandsManager:e,servicesManager:t}){const a=(0,R.useSegmentations)({servicesManager:t});return a?.length?y.createElement("div",{className:"flex gap-2"},y.createElement("div",{className:"flex h-8 w-full items-center rounded pr-0.5"},y.createElement(g.$n,{size:"sm",variant:"ghost",className:"pl-1.5",onClick:()=>{e.runCommand("exportTimeReportCSV",{segmentations:a,options:{filename:"TimeData.csv"}})}},y.createElement(g.FI.Export,null),y.createElement("span",{className:"pl-1"},"Time Data"))),y.createElement("div",{className:"flex h-8 w-full items-center rounded pr-0.5"},y.createElement(g.$n,{size:"sm",variant:"ghost",className:"pl-1.5",onClick:()=>{e.runCommand("exportTimeReportCSV",{segmentations:a,summaryStats:!0,options:{filename:"ROIStats.csv"}})}},y.createElement(g.FI.Export,null),y.createElement("span",{className:"pl-1"},"ROI Stats")))):null};const M=function({commandsManager:e,extensionManager:t,servicesManager:a,configuration:n}){return[{name:"dynamic-volume",iconName:"tab-4d",iconLabel:"4D Workflow",label:"4D Workflow",component:()=>y.createElement(f,{commandsManager:e,servicesManager:a,extensionManager:t})},{name:"dynamic-segmentation",iconName:"tab-segmentation",iconLabel:"Segmentation",label:"Segmentation",component:()=>y.createElement(y.Fragment,null,y.createElement(g.OO,{commandsManager:e,servicesManager:a,extensionManager:t,buttonSectionId:"dynamic-toolbox",title:"Threshold Tools"}),y.createElement(R.PanelSegmentation,{servicesManager:a,commandsManager:e,extensionManager:t,configuration:n},y.createElement(A,{servicesManager:a,commandsManager:e})))}]},w="2hot",L="dynamic4D-pt",P="dynamic4D-fusion",U="dynamic4D-ct";function b({colormap:e,voiInverted:t}={}){return{blendMode:"MIP",colormap:e,voi:{windowWidth:5,windowCenter:2.5},voiInverted:t}}function x(){const e={colormap:{name:w,opacity:[{value:0,opacity:0},{value:.1,opacity:1},{value:1,opacity:1}]},voiInverted:!1};return[{viewportOptions:{viewportId:"ptAxial",viewportType:"volume",orientation:"axial",toolGroupId:L,initialImageOptions:{preset:"middle"},syncGroups:[{type:"cameraPosition",id:"axialSync",source:!0,target:!0},{type:"voi",id:"ptWLSync",source:!0,target:!0}]},displaySets:[{id:"ptDisplaySet",options:{...b(e)}}]},{viewportOptions:{viewportId:"ptSagittal",viewportType:"volume",orientation:"sagittal",toolGroupId:L,initialImageOptions:{preset:"middle"},syncGroups:[{type:"cameraPosition",id:"sagittalSync",source:!0,target:!0},{type:"voi",id:"ptWLSync",source:!0,target:!0}]},displaySets:[{id:"ptDisplaySet",options:{...b(e)}}]},{viewportOptions:{viewportId:"ptCoronal",viewportType:"volume",orientation:"coronal",toolGroupId:L,initialImageOptions:{preset:"middle"},syncGroups:[{type:"cameraPosition",id:"coronalSync",source:!0,target:!0},{type:"voi",id:"ptWLSync",source:!0,target:!0}]},displaySets:[{id:"ptDisplaySet",options:{...b(e)}}]}]}function F(){const e={colormap:{name:w,opacity:[{value:0,opacity:0},{value:.1,opacity:.8},{value:1,opacity:.8}]}};return[{viewportOptions:{viewportId:"fusionAxial",viewportType:"volume",orientation:"axial",toolGroupId:P,initialImageOptions:{preset:"middle"},syncGroups:[{type:"cameraPosition",id:"axialSync",source:!0,target:!0},{type:"voi",id:"ctWLSync",source:!1,target:!0},{type:"voi",id:"fusionWLSync",source:!0,target:!0},{type:"voi",id:"ptFusionWLSync",source:!1,target:!0,options:{syncInvertState:!1}},{type:"hydrateseg",id:"sameFORId",source:!0,target:!0,options:{matchingRules:["sameFOR"]}}]},displaySets:[{id:"ctDisplaySet"},{options:{...b(e)},id:"ptDisplaySet"}]},{viewportOptions:{viewportId:"fusionSagittal",viewportType:"volume",orientation:"sagittal",toolGroupId:P,initialImageOptions:{preset:"middle"},syncGroups:[{type:"cameraPosition",id:"sagittalSync",source:!0,target:!0},{type:"voi",id:"ctWLSync",source:!1,target:!0},{type:"voi",id:"fusionWLSync",source:!0,target:!0},{type:"voi",id:"ptFusionWLSync",source:!1,target:!0,options:{syncInvertState:!1}},{type:"hydrateseg",id:"sameFORId",source:!0,target:!0,options:{matchingRules:["sameFOR"]}}]},displaySets:[{id:"ctDisplaySet"},{options:{...b(e)},id:"ptDisplaySet"}]},{viewportOptions:{viewportId:"fusionCoronal",viewportType:"volume",orientation:"coronal",toolGroupId:P,initialImageOptions:{preset:"middle"},syncGroups:[{type:"cameraPosition",id:"coronalSync",source:!0,target:!0},{type:"voi",id:"ctWLSync",source:!1,target:!0},{type:"voi",id:"fusionWLSync",source:!0,target:!0},{type:"voi",id:"ptFusionWLSync",source:!1,target:!0,options:{syncInvertState:!1}},{type:"hydrateseg",id:"sameFORId",source:!0,target:!0,options:{matchingRules:["sameFOR"]}}]},displaySets:[{id:"ctDisplaySet"},{options:{...b(e)},id:"ptDisplaySet"}]}]}const V={id:"default4D",locked:!0,hasUpdatedPriorsInformation:!1,name:"Default",createdDate:"2023-01-01T00:00:00.000Z",modifiedDate:"2023-01-01T00:00:00.000Z",availableTo:{},editableBy:{},imageLoadStrategy:"default",protocolMatchingRules:[{attribute:"ModalitiesInStudy",constraint:{contains:["CT","PT"]}}],numberOfPriorsReferenced:-1,displaySetSelectors:{defaultDisplaySetId:{imageMatchingRules:[],seriesMatchingRules:[{attribute:"numImageFrames",constraint:{greaterThan:{value:0}}}]},ctDisplaySet:{imageMatchingRules:[],seriesMatchingRules:[{attribute:"Modality",constraint:{equals:{value:"CT"}},required:!0},{attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0}]},ptDisplaySet:{imageMatchingRules:[],seriesMatchingRules:[{attribute:"Modality",constraint:{equals:"PT"},required:!0},{attribute:"isReconstructable",constraint:{equals:{value:!0}},required:!0},{attribute:"SeriesDescription",constraint:{contains:"Corrected"}},{weight:2,attribute:"SeriesDescription",constraint:{doesNotContain:{value:"Uncorrected"}}}]},chartDisplaySet:{imageMatchingRules:[],seriesMatchingRules:[{attribute:"Modality",constraint:{equals:{value:"CHT"}},required:!0}]}},stages:[{id:"dataPreparation",name:"Data Preparation",viewportStructure:{layoutType:"grid",properties:{rows:1,columns:3}},viewports:[...x()],createdDate:"2023-01-01T00:00:00.000Z"},{id:"registration",name:"Registration",viewportStructure:{layoutType:"grid",properties:{rows:3,columns:3}},viewports:[...F(),{viewportOptions:{viewportId:"ctAxial",viewportType:"volume",orientation:"axial",toolGroupId:U,initialImageOptions:{preset:"middle"},syncGroups:[{type:"cameraPosition",id:"axialSync",source:!0,target:!0},{type:"voi",id:"ctWLSync",source:!0,target:!0}]},displaySets:[{id:"ctDisplaySet"}]},{viewportOptions:{viewportId:"ctSagittal",viewportType:"volume",orientation:"sagittal",toolGroupId:U,initialImageOptions:{preset:"middle"},syncGroups:[{type:"cameraPosition",id:"sagittalSync",source:!0,target:!0},{type:"voi",id:"ctWLSync",source:!0,target:!0}]},displaySets:[{id:"ctDisplaySet"}]},{viewportOptions:{viewportId:"ctCoronal",viewportType:"volume",orientation:"coronal",toolGroupId:U,initialImageOptions:{preset:"middle"},syncGroups:[{type:"cameraPosition",id:"coronalSync",source:!0,target:!0},{type:"voi",id:"ctWLSync",source:!0,target:!0}]},displaySets:[{id:"ctDisplaySet"}]},...x()],createdDate:"2023-01-01T00:00:00.000Z"},{id:"roiQuantification",name:"ROI Quantification",viewportStructure:{layoutType:"grid",properties:{rows:1,columns:3}},viewports:[...F()],createdDate:"2023-01-01T00:00:00.000Z"},{id:"kineticAnalysis",name:"Kinetic Analysis",viewportStructure:{layoutType:"grid",properties:{rows:2,columns:3,layoutOptions:[{x:0,y:0,width:1/3,height:.5},{x:1/3,y:0,width:1/3,height:.5},{x:2/3,y:0,width:1/3,height:.5},{x:0,y:.5,width:1,height:.5}]}},viewports:[...F(),{viewportOptions:{viewportId:"seriesChart"},displaySets:[{id:"chartDisplaySet",options:{skipLoading:!0}}]}],createdDate:"2023-01-01T00:00:00.000Z"}]};const G={id:i,preRegistration:({servicesManager:e,commandsManager:t,configuration:a={}})=>{s.cache.setMaxCacheSize(5368709120)},getPanelModule:M,getHangingProtocolModule:function(){return[{name:V.id,protocol:V}]},getCommandsModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>E({servicesManager:e,commandsManager:t,extensionManager:a})}}}]);
//# sourceMappingURL=7013.bundle.7f1ffa2a35433d326101.js.map